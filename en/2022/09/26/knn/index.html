<a name=top></a><!doctype html>
<html lang=en-us>
<head>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1">
<title>郝鸿涛：Hongtao Hao</title>
<link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css>
<link rel=stylesheet href=/css/style.css>
<link rel=stylesheet href=/css/fonts.css>
<link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/styles/github.min.css rel=stylesheet>
<script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/highlight.min.js></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/languages/r.min.js></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/languages/bash.min.js></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/languages/python.min.js></script>
<script src=https://cdn.jsdelivr.net/npm/vega@5.17.0></script>
<script src=https://cdn.jsdelivr.net/npm/vega-lite@4.17.0></script>
<script src=https://cdn.jsdelivr.net/npm/vega-embed@6.12.2></script>
<script>hljs.initHighlightingOnLoad()</script>
<link rel=icon href=https://hongtaoh.com/ht10.ico>
</head>
<body>
<div class=wrapper>
<header class=header>
<nav class=nav>
<a href=/ class=nav-logo>
<img src=/media/ht10.png width=50 height=50 alt="Hongtao Hao">
</a>
<ul class=nav-links>
<li><a href=/>Home</a></li>
<li><a href=/en/vitae/>Vitae</a></li>
<li><a href=/en/projects/>Projects</a></li>
<li><a href=/en/research/>Research</a></li>
<li><a href=/en/blog/>Blog</a></li>
<li><a href=/en/apad/>APAD</a></li>
<li><a href=/cn/blog/>中文</a></li>
</ul>
</nav>
</header>
<main class=content role=main>
<div style=text-align:center>
<h1>Understanding K-Nearest Neighbors Using MNIST Dataset</h1>
<p>Hongtao Hao
/ 2022-09-26 </p>
<hr>
</div>
<span class=article-toolbar>
<a href=https://github.com/hongtaoh/hongtaoh.github.io/edit/sources/content/en/blog/2022-09-26-knn.md style=font-size:24px;color:#000 target=_blank><i class="fa fa-edit" aria-hidden=true title="Suggest an edit of this page"></i>
</a>
</span>
<aside class=toc>
Table of Contents:
<nav id=TableOfContents>
<ul>
<li><a href=#introduction-to-mnist-dataset>Introduction to MNIST dataset</a></li>
<li><a href=#knn>KNN</a>
<ul>
<li><a href=#training-examples>Training examples</a></li>
<li><a href=#test-examples>Test examples</a></li>
<li><a href=#k-nearest-neighbors>K-Nearest Neighbors</a></li>
</ul>
</li>
</ul>
</nav>
</aside>
<div class="body-text list-text">
<p>To me, K Nearest Neighbors (KNN) is very intuitive. Take classification tasks as an example. What KNN does is to find K training examples that are &ldquo;closest&rdquo; to the test example. These K training examples have K labels. We find the most common label, and it is the predicted label for the test example in question.</p>
<p>How to quantify &ldquo;closest&rdquo;? Two simple methods are Euclidean distance or Manhattan distance.</p>
<p>I&rsquo;ll take the MNIST dataset as an example.</p>
<div class=highlight><pre tabindex=0 style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:green;font-weight:700>import</span> <span style=color:#00f;font-weight:700>pandas</span> <span style=color:green;font-weight:700>as</span> <span style=color:#00f;font-weight:700>pd</span>
<span style=color:green;font-weight:700>import</span> <span style=color:#00f;font-weight:700>numpy</span> <span style=color:green;font-weight:700>as</span> <span style=color:#00f;font-weight:700>np</span>
<span style=color:green;font-weight:700>import</span> <span style=color:#00f;font-weight:700>matplotlib.pyplot</span> <span style=color:green;font-weight:700>as</span> <span style=color:#00f;font-weight:700>plt</span>
<span style=color:green;font-weight:700>import</span> <span style=color:#00f;font-weight:700>seaborn</span> <span style=color:green;font-weight:700>as</span> <span style=color:#00f;font-weight:700>sns</span>
<span style=color:green;font-weight:700>from</span> <span style=color:#00f;font-weight:700>collections</span> <span style=color:green;font-weight:700>import</span> Counter
</code></pre></div><h2 id=introduction-to-mnist-dataset>Introduction to MNIST dataset<a href=#introduction-to-mnist-dataset class=header-anchor arialabel=Anchor> # </a></h2>
<div class=highlight><pre tabindex=0 style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python>file <span style=color:#666>=</span> <span style=color:#ba2121>&#39;../static/files/large/mnist_train.csv&#39;</span>
<span style=color:#408080;font-style:italic># you can download the files here: https://pjreddie.com/projects/mnist-in-csv/</span>
</code></pre></div><div class=highlight><pre tabindex=0 style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python>df <span style=color:#666>=</span> pd<span style=color:#666>.</span>read_csv(file)
</code></pre></div><div class=highlight><pre tabindex=0 style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python>df<span style=color:#666>.</span>shape
</code></pre></div><pre><code>(59999, 785)
</code></pre>
<div class=highlight><pre tabindex=0 style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#408080;font-style:italic># df.head()</span>
</code></pre></div><p><img src=/en/blog/2022-09-26-knn_files/knn-df-head.png alt></p>
<p>The above is the MNIST dataset. It has close to 60K training examples, i.e., images. Each training example has 785 columns. The first column is the label and the remaining 784 (28 <code>$\times$</code> 28) columns are the input. Each of these 784 columns correspondes to a pixel, which I will explain later.</p>
<p>The raw inputs are RGB values which range from 0 to 255:</p>
<div class=highlight><pre tabindex=0 style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python>np<span style=color:#666>.</span>max(df<span style=color:#666>.</span>to_numpy())
</code></pre></div><pre><code>255
</code></pre>
<p>We normally would <a href=https://stackoverflow.com/a/37421202 target=_blank rel="noreferrer noopener">normalize the inputs</a>
so that they values are between 0 (black) and 1 (white). To do that, we divide each pixel value by the number of 255.</p>
<p>Let&rsquo;s take a look at one example.</p>
<div class=highlight><pre tabindex=0 style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python>example_to_draw <span style=color:#666>=</span> df<span style=color:#666>.</span>iloc[<span style=color:#666>0</span>, <span style=color:#666>1</span>:]<span style=color:#666>.</span>to_numpy()<span style=color:#666>.</span>reshape(<span style=color:#666>28</span>,<span style=color:#666>28</span>)
plt<span style=color:#666>.</span>imshow(example_to_draw, cmap<span style=color:#666>=</span><span style=color:#ba2121>&#39;gray&#39;</span>)
plt<span style=color:#666>.</span>show()
</code></pre></div><p><img src=/en/blog/2022-09-26-knn_files/2022-09-26-knn_12_0.png alt=png></p>
<h2 id=knn>KNN<a href=#knn class=header-anchor arialabel=Anchor> # </a></h2>
<h3 id=training-examples>Training examples<a href=#training-examples class=header-anchor arialabel=Anchor> # </a></h3>
<p>Since there are 60K examples, for simplicity, I&rsquo;ll randomly choose 10K of them as training examples.</p>
<div class=highlight><pre tabindex=0 style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python>training_samples <span style=color:#666>=</span> df<span style=color:#666>.</span>sample(<span style=color:#666>10000</span>, random_state <span style=color:#666>=</span> <span style=color:#666>222</span>)
training_indices <span style=color:#666>=</span> training_samples<span style=color:#666>.</span>index
</code></pre></div><div class=highlight><pre tabindex=0 style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python>x_train <span style=color:#666>=</span> (training_samples<span style=color:#666>.</span>iloc[:, <span style=color:#666>1</span>:]<span style=color:#666>/</span><span style=color:#666>255</span>)<span style=color:#666>.</span>to_numpy()
y_train <span style=color:#666>=</span> training_samples<span style=color:#666>.</span>iloc[:, <span style=color:#666>0</span>]<span style=color:#666>.</span>to_numpy()
</code></pre></div><div class=highlight><pre tabindex=0 style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python>x_train<span style=color:#666>.</span>shape, y_train<span style=color:#666>.</span>shape
</code></pre></div><pre><code>((10000, 784), (10000,))
</code></pre>
<div class=highlight><pre tabindex=0 style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python>Counter(y_train)
</code></pre></div><pre><code>Counter({4: 957,
         5: 920,
         2: 1005,
         7: 1060,
         8: 1019,
         1: 1160,
         0: 966,
         9: 974,
         3: 958,
         6: 981})
</code></pre>
<div class=highlight><pre tabindex=0 style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python>label_counts <span style=color:#666>=</span> pd<span style=color:#666>.</span>DataFrame(Counter(y_train)<span style=color:#666>.</span>items(), columns <span style=color:#666>=</span> [<span style=color:#ba2121>&#39;label&#39;</span>, <span style=color:#ba2121>&#39;frequency&#39;</span>])
sns<span style=color:#666>.</span>barplot(data <span style=color:#666>=</span> label_counts, x <span style=color:#666>=</span> <span style=color:#ba2121>&#39;label&#39;</span>, y <span style=color:#666>=</span> <span style=color:#ba2121>&#39;frequency&#39;</span>)
</code></pre></div><pre><code>&lt;AxesSubplot:xlabel='label', ylabel='frequency'&gt;
</code></pre>
<p><img src=/en/blog/2022-09-26-knn_files/2022-09-26-knn_19_1.png alt=png></p>
<h3 id=test-examples>Test examples<a href=#test-examples class=header-anchor arialabel=Anchor> # </a></h3>
<p>I will have 100 images as test examples.</p>
<div class=highlight><pre tabindex=0 style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python>testing_samples <span style=color:#666>=</span> df[<span style=color:#666>~</span>df<span style=color:#666>.</span>index<span style=color:#666>.</span>isin(training_indices)]<span style=color:#666>.</span>sample(<span style=color:#666>100</span>, random_state <span style=color:#666>=</span> <span style=color:#666>300</span>)
</code></pre></div><div class=highlight><pre tabindex=0 style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python>x_test <span style=color:#666>=</span> (testing_samples<span style=color:#666>.</span>iloc[:, <span style=color:#666>1</span>:]<span style=color:#666>/</span><span style=color:#666>255</span>)<span style=color:#666>.</span>to_numpy()
y_test <span style=color:#666>=</span> testing_samples<span style=color:#666>.</span>iloc[:, <span style=color:#666>0</span>]<span style=color:#666>.</span>to_numpy()
</code></pre></div><div class=highlight><pre tabindex=0 style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python>x_test<span style=color:#666>.</span>shape, y_test<span style=color:#666>.</span>shape
</code></pre></div><pre><code>((100, 784), (100,))
</code></pre>
<div class=highlight><pre tabindex=0 style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python>label_counts <span style=color:#666>=</span> pd<span style=color:#666>.</span>DataFrame(Counter(y_test)<span style=color:#666>.</span>items(), columns <span style=color:#666>=</span> [<span style=color:#ba2121>&#39;label&#39;</span>, <span style=color:#ba2121>&#39;frequency&#39;</span>])
sns<span style=color:#666>.</span>barplot(data <span style=color:#666>=</span> label_counts, x <span style=color:#666>=</span> <span style=color:#ba2121>&#39;label&#39;</span>, y <span style=color:#666>=</span> <span style=color:#ba2121>&#39;frequency&#39;</span>)
</code></pre></div><pre><code>&lt;AxesSubplot:xlabel='label', ylabel='frequency'&gt;
</code></pre>
<p><img src=/en/blog/2022-09-26-knn_files/2022-09-26-knn_24_1.png alt=png></p>
<h3 id=k-nearest-neighbors>K-Nearest Neighbors<a href=#k-nearest-neighbors class=header-anchor arialabel=Anchor> # </a></h3>
<div class=highlight><pre tabindex=0 style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:green;font-weight:700>def</span> <span style=color:#00f>eu_distance</span>(v1, v2):
    <span style=color:#ba2121>&#39;&#39;&#39;to calculate the euclidean distance of two vectors
</span><span style=color:#ba2121>        input: vector1, vector2
</span><span style=color:#ba2121>    &#39;&#39;&#39;</span>
    s <span style=color:#666>=</span> np<span style=color:#666>.</span>sum((v1<span style=color:#666>-</span>v2)<span style=color:#666>**</span><span style=color:#666>2</span>)
    d <span style=color:#666>=</span> np<span style=color:#666>.</span>sqrt(s)
    <span style=color:green;font-weight:700>return</span> d
</code></pre></div><div class=highlight><pre tabindex=0 style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:green;font-weight:700>def</span> <span style=color:#00f>knn</span>(test_example, x_train, k):
    
    <span style=color:#408080;font-style:italic># calculate the euclidean distance between the test example and </span>
    <span style=color:#408080;font-style:italic># each example x_train. Accumulate these distances to sort later</span>
    distances <span style=color:#666>=</span> np<span style=color:#666>.</span>array([eu_distance(test_example, i) <span style=color:green;font-weight:700>for</span> i <span style=color:#a2f;font-weight:700>in</span> x_train])
    
    <span style=color:#408080;font-style:italic># np.argsort sorts the distances in ascending order, and return the index </span>
    <span style=color:#408080;font-style:italic># of items in the original (unsorted) array </span>
    sorted_idx <span style=color:#666>=</span> np<span style=color:#666>.</span>argsort(distances)
    
    <span style=color:#408080;font-style:italic># we only want the k smallest distances</span>
    <span style=color:green;font-weight:700>return</span> sorted_idx[<span style=color:#666>0</span>:k]
</code></pre></div><p>Let&rsquo;s take one example. Exciting moment!</p>
<div class=highlight><pre tabindex=0 style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#408080;font-style:italic>## example 1:</span>
eg1 <span style=color:#666>=</span> x_test[<span style=color:#666>1</span>]
plt<span style=color:#666>.</span>imshow(eg1<span style=color:#666>.</span>reshape(<span style=color:#666>28</span>, <span style=color:#666>28</span>), cmap<span style=color:#666>=</span><span style=color:#ba2121>&#39;gray&#39;</span>)
</code></pre></div><pre><code>&lt;matplotlib.image.AxesImage at 0x11492a3b0&gt;
</code></pre>
<p><img src=/en/blog/2022-09-26-knn_files/2022-09-26-knn_29_1.png alt=png></p>
<div class=highlight><pre tabindex=0 style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#408080;font-style:italic># Let&#39;s say k = 3</span>
k <span style=color:#666>=</span> <span style=color:#666>3</span>
knn_results <span style=color:#666>=</span> knn(eg1, x_train, k)
knn_results
</code></pre></div><pre><code>array([7572, 4714, 5533])
</code></pre>
<div class=highlight><pre tabindex=0 style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python>f, axs <span style=color:#666>=</span> plt<span style=color:#666>.</span>subplots(<span style=color:#666>1</span>,<span style=color:#666>3</span>,
                      figsize<span style=color:#666>=</span>(<span style=color:#666>14</span>,<span style=color:#666>5</span>),
                      sharex<span style=color:#666>=</span><span style=color:green;font-weight:700>False</span>,
                      sharey<span style=color:#666>=</span><span style=color:green;font-weight:700>False</span>,)
<span style=color:green;font-weight:700>for</span> i <span style=color:#a2f;font-weight:700>in</span> <span style=color:green>range</span>(k):
    result <span style=color:#666>=</span> knn_results[i]
    axs[i]<span style=color:#666>.</span>imshow(x_train[result]<span style=color:#666>.</span>reshape(<span style=color:#666>28</span>,<span style=color:#666>28</span>), cmap<span style=color:#666>=</span><span style=color:#ba2121>&#39;gray&#39;</span>)
</code></pre></div><p><img src=/en/blog/2022-09-26-knn_files/2022-09-26-knn_31_0.png alt=png></p>
<p>These three nearest neighbors have the label of &lsquo;6&rsquo;, so the label for <code>eg1</code> should be &lsquo;6&rsquo; as well.</p>
<div class=highlight><pre tabindex=0 style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python>y_train[knn_results]
</code></pre></div><pre><code>array([6, 6, 6])
</code></pre>
<p>Let&rsquo;s have another example:</p>
<div class=highlight><pre tabindex=0 style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#408080;font-style:italic># example 2</span>
eg2 <span style=color:#666>=</span> x_test[<span style=color:#666>90</span>]
plt<span style=color:#666>.</span>imshow(eg2<span style=color:#666>.</span>reshape(<span style=color:#666>28</span>, <span style=color:#666>28</span>), cmap<span style=color:#666>=</span><span style=color:#ba2121>&#39;gray&#39;</span>)
</code></pre></div><pre><code>&lt;matplotlib.image.AxesImage at 0x11439f070&gt;
</code></pre>
<p><img src=/en/blog/2022-09-26-knn_files/2022-09-26-knn_35_1.png alt=png></p>
<div class=highlight><pre tabindex=0 style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#408080;font-style:italic># Let&#39;s say k = 3</span>
k <span style=color:#666>=</span> <span style=color:#666>3</span>
knn_results <span style=color:#666>=</span> knn(eg2, x_train, k)
knn_results
</code></pre></div><pre><code>array([9273, 7022, 4709])
</code></pre>
<div class=highlight><pre tabindex=0 style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python>f, axs <span style=color:#666>=</span> plt<span style=color:#666>.</span>subplots(<span style=color:#666>1</span>,<span style=color:#666>3</span>,
                      figsize<span style=color:#666>=</span>(<span style=color:#666>14</span>,<span style=color:#666>5</span>),
                      sharex<span style=color:#666>=</span><span style=color:green;font-weight:700>False</span>,
                      sharey<span style=color:#666>=</span><span style=color:green;font-weight:700>False</span>,)
<span style=color:green;font-weight:700>for</span> i <span style=color:#a2f;font-weight:700>in</span> <span style=color:green>range</span>(k):
    result <span style=color:#666>=</span> knn_results[i]
    axs[i]<span style=color:#666>.</span>imshow(x_train[result]<span style=color:#666>.</span>reshape(<span style=color:#666>28</span>,<span style=color:#666>28</span>), cmap<span style=color:#666>=</span><span style=color:#ba2121>&#39;gray&#39;</span>)
</code></pre></div><p><img src=/en/blog/2022-09-26-knn_files/2022-09-26-knn_37_0.png alt=png></p>
<p>These three nearest neighbors have the label of &lsquo;7&rsquo;, so the label for <code>eg2</code> should be &lsquo;7&rsquo; as well.</p>
<div class=highlight><pre tabindex=0 style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python>y_train[knn_results]
</code></pre></div><pre><code>array([7, 7, 7])
</code></pre>
<a href=https://hongtaoh.com/tags/ml/>#ML</a>
<p style=color:#777>Last modified on 2022-09-27</p>
</div>
<a href=#top><i class="fa fa-chevron-up" style=font-size:30px;color:#000></i></a>
</main>
<footer class=footer>
<script src=https://utteranc.es/client.js repo=hongtaoh/hongtaoh.github.io issue-term=pathname theme=github-light crossorigin=anonymous async></script>
<script type=text/javascript src=/js/math-code.js></script>
<script async src="//mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML"></script>
<script type=text/javascript src=/js/center-img.js></script>
<ul class=footer-links>
<li><a href=/en/blog/index.xml type=application/rss+xml title="RSS feed">
Subscribe </a>
</li>
<li>
<a href=http://creativecommons.org/licenses/by-nc-sa/4.0/ target=_blank>
License
<i class="fa fa-cc" aria-hidden=true title="Attribution-NonCommercial-ShareAlike 4.0 International"></i>
</a>
</li>
</ul>
<div class=copyright-text>
©
Hongtao Hao
2020-2022
</div>
</footer>