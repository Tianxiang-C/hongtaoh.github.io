<a name=top></a><!doctype html>
<html lang=en-us>
<head>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1">
<title>郝鸿涛：Hongtao Hao</title>
<link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css>
<link rel=stylesheet href=/css/style.css>
<link rel=stylesheet href=/css/fonts.css>
<link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/styles/github.min.css rel=stylesheet>
<script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/highlight.min.js></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/languages/r.min.js></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/languages/bash.min.js></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/languages/python.min.js></script>
<script src=https://cdn.jsdelivr.net/npm/vega@5.17.0></script>
<script src=https://cdn.jsdelivr.net/npm/vega-lite@4.17.0></script>
<script src=https://cdn.jsdelivr.net/npm/vega-embed@6.12.2></script>
<script>hljs.initHighlightingOnLoad()</script>
<link rel=icon href=https://hongtaoh.com/ht10.ico>
</head>
<body>
<div class=wrapper>
<header class=header>
<nav class=nav>
<a href=/ class=nav-logo>
<img src=/media/ht10.png width=50 height=50 alt="Hongtao Hao">
</a>
<ul class=nav-links>
<li><a href=/>Home</a></li>
<li><a href=/en/vitae/>Vitae</a></li>
<li><a href=/en/projects/>Projects</a></li>
<li><a href=/en/blog/>Blog</a></li>
<li><a href=/en/apad/>APAD</a></li>
<li><a href=/cn/blog/>中文</a></li>
</ul>
</nav>
</header>
<main class=content role=main>
<div style=text-align:center>
<h1>Julia: How to Write Data Frames as JSON Files</h1>
<p>Hongtao Hao
/ 2021-07-13 </p>
<hr>
</div>
<span class=article-toolbar>
<a href=https://github.com/hongtaoh/hongtaoh.github.io/edit/sources/content/en/blog/2021-07-13-julia-write-json.md style=font-size:24px;color:#000 target=_blank><i class="fa fa-edit" aria-hidden=true title="Suggest an edit of this page"></i>
</a>
</span>
<aside class=toc>
Table of Contents:
<nav id=TableOfContents>
<ul>
<li><a href=#json-object-of-arrays>JSON object of arrays</a></li>
<li><a href=#json-array-of-objects>JSON array of objects</a></li>
<li><a href=#practice-a-more-complicated-data-frame>Practice: a more complicated data frame</a></li>
<li><a href=#references>References</a></li>
</ul>
</nav>
</aside>
<div class="body-text list-text">
<p><div class=tip>
The following post is tested under Julia v1.6.1, DataFrames.jl v1.2.0, JSON.jl v0.21.1, and JSONTables.jl v1.0.1.
</div></p>
<p>To export data frames as JSON files in Julia, you need <a href=https://github.com/JuliaIO/JSON.jl target=_blank rel="noreferrer noopener"><code>JSON.jl</code></a>
, or <a href=https://github.com/JuliaData/JSONTables.jl target=_blank rel="noreferrer noopener"><code>JSONTables.jl</code></a>
. The key difference between the two packages is that <code>JSON.jl</code> transforms <strong>a dictionary, a vector of dictionaries, or a vector of DataFrameRow</strong>, whereas <code>JSONTables.jl</code> processes <strong>dataframes</strong>. Note that <code>JSON.jl</code> might be capable of processing other forms of data than what I mentioned above, but I don&rsquo;t know what they are.</p>
<p>To write JSON files, the output can either be a json object of arrays, or a json array of objects. I&rsquo;ll explain the differences between the two in the following part.</p>
<p>Let&rsquo;s first look at a simple example.</p>
<div class=highlight><pre tabindex=0 style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-julia data-lang=julia><span style=color:green;font-weight:700>using</span> DataFrames, JSON, Dates, DataStructures, JSONTables, Random
dates_simple <span style=color:#666>=</span> collect(Date(<span style=color:#666>2021</span>,<span style=color:#666>1</span>,<span style=color:#666>1</span>)<span style=color:#666>:</span>Day(<span style=color:#666>1</span>)<span style=color:#666>:</span>Date(<span style=color:#666>2021</span>,<span style=color:#666>1</span>,<span style=color:#666>5</span>))
names_simple <span style=color:#666>=</span> [<span style=color:#ba2121>&#34;John&#34;</span>, <span style=color:#ba2121>&#34;Mike&#34;</span>, <span style=color:#ba2121>&#34;Tom&#34;</span>, <span style=color:#ba2121>&#34;David&#34;</span>, <span style=color:#ba2121>&#34;Joshua&#34;</span>]
properties_simple <span style=color:#666>=</span> [<span style=color:#ba2121>&#34;Awesome&#34;</span>, <span style=color:#ba2121>&#34;Amazing&#34;</span>, <span style=color:#ba2121>&#34;Excellent&#34;</span>, <span style=color:#ba2121>&#34;Wonderful&#34;</span>, <span style=color:#ba2121>&#34;Awful&#34;</span>]
values_simple <span style=color:#666>=</span> rand(<span style=color:#666>5</span>)
df_simple <span style=color:#666>=</span> DataFrame(<span style=color:#19177c>:Date</span> <span style=color:#666>=&gt;</span> dates_simple, <span style=color:#19177c>:Name</span> <span style=color:#666>=&gt;</span> names_simple, 
    <span style=color:#19177c>:Property</span> <span style=color:#666>=&gt;</span> properties_simple, <span style=color:#19177c>:Value</span> <span style=color:#666>=&gt;</span> values_simple)
</code></pre></div><pre tabindex=0><code>julia&gt; df_simple

5×4 DataFrame
 Row │ Date        Name    Property   Value    
     │ Date        String  String     Float64  
─────┼─────────────────────────────────────────
   1 │ 2021-01-01  John    Awesome    0.590845
   2 │ 2021-01-02  Mike    Amazing    0.766797
   3 │ 2021-01-03  Tom     Excellent  0.566237
   4 │ 2021-01-04  David   Wonderful  0.460085
   5 │ 2021-01-05  Joshua  Awful      0.794026
</code></pre><h2 id=json-object-of-arrays>JSON object of arrays<a href=#json-object-of-arrays class=header-anchor arialabel=Anchor> # </a></h2>
<p>Let&rsquo;s first look at how to produce a json object of arrays. In a json object of arrays, each column name will be this object&rsquo;s key, and the content of this column will be the key&rsquo;s value.</p>
<p>The easiest way to get a json object of arrays is through JSONTables.jl&rsquo;s <code>objecttable()</code>.</p>
<div class=highlight><pre tabindex=0 style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-julia data-lang=julia>jts_objecttable_source <span style=color:#666>=</span> objecttable(df_simple) <span style=color:#408080;font-style:italic># jts here stands for JSONTables</span>
open(<span style=color:#ba2121>&#34;jts_objecttable.json&#34;</span>, <span style=color:#ba2121>&#34;w&#34;</span>) <span style=color:green;font-weight:700>do</span> f
    write(f, jts_objecttable_source)
<span style=color:green;font-weight:700>end</span>
</code></pre></div><figure class=fullwidth itemprop=associatedMedia itemscope itemtype=http://schema.org/ImageObject>
<a href=/media/enblog/julia_write_json/jts_objecttable.png itemprop=contentUrl>
<img itemprop=thumbnail src=/media/enblog/julia_write_json/jts_objecttable.png alt="Results of jts_objecttable.json (rendered on Observablehq)">
</a>
<figcaption>
<p>
Results of jts_objecttable.json (rendered on Observablehq)
</p>
</figcaption>
</figure>
<p>We can achieve this through <code>JSON.jl</code> as well, and there are two ways we can do this.</p>
<p>The first solution:</p>
<div class=highlight><pre tabindex=0 style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-julia data-lang=julia>df_simple_dict <span style=color:#666>=</span> OrderedDict(<span style=color:#19177c>:Date</span> <span style=color:#666>=&gt;</span> dates_simple, <span style=color:#19177c>:Name</span> <span style=color:#666>=&gt;</span> names_simple, 
    <span style=color:#19177c>:Property</span> <span style=color:#666>=&gt;</span> properties_simple, <span style=color:#19177c>:Value</span> <span style=color:#666>=&gt;</span> values_simple)
json_string_jjl_1 <span style=color:#666>=</span> JSON<span style=color:#666>.</span>json(df_simple_dict)
open(<span style=color:#ba2121>&#34;jjl_objecttable_1.json&#34;</span>, <span style=color:#ba2121>&#34;w&#34;</span>) <span style=color:green;font-weight:700>do</span> f <span style=color:#408080;font-style:italic># jjl here stands for json.jl; w means &#34;writing&#34;</span>
    write(f, json_string_jjl_1)
<span style=color:green;font-weight:700>end</span>
</code></pre></div><figure class=fullwidth itemprop=associatedMedia itemscope itemtype=http://schema.org/ImageObject>
<a href=/media/enblog/julia_write_json/jjl_objecttable_1.png itemprop=contentUrl>
<img itemprop=thumbnail src=/media/enblog/julia_write_json/jjl_objecttable_1.png alt="Results of jjl_objecttable_1.json (rendered on Observablehq)">
</a>
<figcaption>
<p>
Results of jjl_objecttable_1.json (rendered on Observablehq)
</p>
</figcaption>
</figure>
<p>The second solution:</p>
<div class=highlight><pre tabindex=0 style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-julia data-lang=julia>open(<span style=color:#ba2121>&#34;jjl_objecttable_2.json&#34;</span>, <span style=color:#ba2121>&#34;w&#34;</span>) <span style=color:green;font-weight:700>do</span> f
    JSON<span style=color:#666>.</span>print(f, df_simple_dict)
<span style=color:green;font-weight:700>end</span>
</code></pre></div><figure class=fullwidth itemprop=associatedMedia itemscope itemtype=http://schema.org/ImageObject>
<a href=/media/enblog/julia_write_json/jjl_objecttable_2.png itemprop=contentUrl>
<img itemprop=thumbnail src=/media/enblog/julia_write_json/jjl_objecttable_2.png alt="Results of jjl_objecttable_2.json (rendered on Observablehq)">
</a>
<figcaption>
<p>
Results of jjl_objecttable_2.json (rendered on Observablehq)
</p>
</figcaption>
</figure>
<p>As you can see, the first option first transforms <code>df_simple_dict</code> into JSON, and then uses the <code>write()</code> function to export the JSON file. The second option uses <code>JSON.print()</code> to do conversion and exporting simultaneously.</p>
<p>You have these two options when exporting files through <code>JSON.jl</code>. I&rsquo;ll use the second one for illustration later in this post.</p>
<h2 id=json-array-of-objects>JSON array of objects<a href=#json-array-of-objects class=header-anchor arialabel=Anchor> # </a></h2>
<p>In a JSON array of objects, each row in the data frame will be an object in which the df&rsquo;s column name is the key and the cell value is the value.</p>
<p>It&rsquo;s very easy to produce a JSON array of objects using JSONTables.jl&rsquo;s <code>arraytable()</code> function:</p>
<div class=highlight><pre tabindex=0 style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-julia data-lang=julia>jts_arraytable_source <span style=color:#666>=</span> arraytable(df_simple) <span style=color:#408080;font-style:italic># jts here stands for JSONTables</span>
open(<span style=color:#ba2121>&#34;jts_arraytable.json&#34;</span>, <span style=color:#ba2121>&#34;w&#34;</span>) <span style=color:green;font-weight:700>do</span> f
    write(f, jts_arraytable_source)
<span style=color:green;font-weight:700>end</span>
</code></pre></div><figure class=fullwidth itemprop=associatedMedia itemscope itemtype=http://schema.org/ImageObject>
<a href=/media/enblog/julia_write_json/jts_arraytable.png itemprop=contentUrl>
<img itemprop=thumbnail src=/media/enblog/julia_write_json/jts_arraytable.png alt="Results of jts_arraytable.json (rendered on Observablehq)">
</a>
<figcaption>
<p>
Results of jts_arraytable.json (rendered on Observablehq)
</p>
</figcaption>
</figure>
<p>To get a JSON array of objects using <code>JSON.jl</code>, we need to first obtain an array whose element corresponds to each row in the data frame:</p>
<div class=highlight><pre tabindex=0 style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-julia data-lang=julia>array_objects <span style=color:#666>=</span> [] <span style=color:#408080;font-style:italic># initiate an array</span>
<span style=color:#408080;font-style:italic># iterate through the data frame row by row and add each row to array_objects</span>
<span style=color:green;font-weight:700>for</span> r <span style=color:green;font-weight:700>in</span> eachrow(df_simple) 
    push!(array_objects, r)
<span style=color:green;font-weight:700>end</span>

open(<span style=color:#ba2121>&#34;jjl_arraytable.json&#34;</span>, <span style=color:#ba2121>&#34;w&#34;</span>) <span style=color:green;font-weight:700>do</span> f <span style=color:#408080;font-style:italic># jjl here stands for json.jl</span>
    JSON<span style=color:#666>.</span>print(f, array_objects)
<span style=color:green;font-weight:700>end</span>
</code></pre></div><figure class=fullwidth itemprop=associatedMedia itemscope itemtype=http://schema.org/ImageObject>
<a href=/media/enblog/julia_write_json/jjl_arraytable.png itemprop=contentUrl>
<img itemprop=thumbnail src=/media/enblog/julia_write_json/jjl_arraytable.png alt="Results of jjl_arraytable.json (rendered on Observablehq)">
</a>
<figcaption>
<p>
Results of jjl_arraytable.json (rendered on Observablehq)
</p>
</figcaption>
</figure>
<h2 id=practice-a-more-complicated-data-frame>Practice: a more complicated data frame<a href=#practice-a-more-complicated-data-frame class=header-anchor arialabel=Anchor> # </a></h2>
<p>Let&rsquo;s practice through a more complex data frame.</p>
<div class=highlight><pre tabindex=0 style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-julia data-lang=julia>dates <span style=color:#666>=</span> repeat(dates_simple, inner <span style=color:#666>=</span> <span style=color:#666>5</span>)
names <span style=color:#666>=</span> repeat(names_simple, outer <span style=color:#666>=</span> <span style=color:#666>5</span>)
properties <span style=color:#666>=</span> repeat(properties_simple, outer <span style=color:#666>=</span> <span style=color:#666>5</span>)
values <span style=color:#666>=</span> <span style=color:#666>10</span> <span style=color:#666>*</span> rand(<span style=color:#666>25</span>)
df <span style=color:#666>=</span> DataFrame(<span style=color:#19177c>:Date</span> <span style=color:#666>=&gt;</span> dates, <span style=color:#19177c>:Name</span> <span style=color:#666>=&gt;</span> names, <span style=color:#19177c>:Property</span> <span style=color:#666>=&gt;</span> properties, <span style=color:#19177c>:Value</span> <span style=color:#666>=&gt;</span> values)
</code></pre></div><div class=highlight><pre tabindex=0 style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>julia&gt; df

25×4 DataFrame
 Row │ Date        Name    Property   Value    
     │ Date        String  String     Float64  
─────┼─────────────────────────────────────────
   <span style=color:#666>1</span> │ 2021-01-01  John    Awesome    4.96169
   <span style=color:#666>2</span> │ 2021-01-01  Mike    Amazing    7.32
   <span style=color:#666>3</span> │ 2021-01-01  Tom     Excellent  2.99058
   <span style=color:#666>4</span> │ 2021-01-01  David   Wonderful  4.49182
   <span style=color:#666>5</span> │ 2021-01-01  Joshua  Awful      8.75096
   <span style=color:#666>6</span> │ 2021-01-02  John    Awesome    0.462887
   <span style=color:#666>7</span> │ 2021-01-02  Mike    Amazing    6.98356
   <span style=color:#666>8</span> │ 2021-01-02  Tom     Excellent  3.65109
  ⋮  │     ⋮         ⋮         ⋮         ⋮
  <span style=color:#666>19</span> │ 2021-01-04  David   Wonderful  5.9552
  <span style=color:#666>20</span> │ 2021-01-04  Joshua  Awful      2.92462
  <span style=color:#666>21</span> │ 2021-01-05  John    Awesome    2.8858
  <span style=color:#666>22</span> │ 2021-01-05  Mike    Amazing    6.1816
  <span style=color:#666>23</span> │ 2021-01-05  Tom     Excellent  6.6426
  <span style=color:#666>24</span> │ 2021-01-05  David   Wonderful  7.53508
  <span style=color:#666>25</span> │ 2021-01-05  Joshua  Awful      0.368842
                                <span style=color:#666>10</span> rows omitted
</code></pre></div><p>Let&rsquo;s say I want an array of objects, similar to the above array tables. Since each person has five values scattered on five dates, I want the value to contain both the date and the corresponding value.</p>
<p>To do that, we need the <code>groupby()</code> function:</p>
<div class=highlight><pre tabindex=0 style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-julia data-lang=julia>data <span style=color:#666>=</span> []
<span style=color:green;font-weight:700>for</span> g <span style=color:green;font-weight:700>in</span> groupby(df, <span style=color:#19177c>:Name</span>)
    person_data <span style=color:#666>=</span> OrderedDict(
        <span style=color:#ba2121>&#34;Name&#34;</span> <span style=color:#666>=&gt;</span> g<span style=color:#666>.</span>Name[<span style=color:green;font-weight:700>end</span>],
        <span style=color:#ba2121>&#34;Property&#34;</span> <span style=color:#666>=&gt;</span> g<span style=color:#666>.</span>Property[<span style=color:green;font-weight:700>end</span>],
        <span style=color:#ba2121>&#34;Value&#34;</span> <span style=color:#666>=&gt;</span> collect(zip(g<span style=color:#666>.</span>Date, g<span style=color:#666>.</span>Value))
    )
    push!(data, person_data)
<span style=color:green;font-weight:700>end</span>

open(<span style=color:#ba2121>&#34;person_data.json&#34;</span>, <span style=color:#ba2121>&#34;w&#34;</span>) <span style=color:green;font-weight:700>do</span> f
    JSON<span style=color:#666>.</span>print(f, data)
<span style=color:green;font-weight:700>end</span>
</code></pre></div><figure itemprop=associatedMedia itemscope itemtype=http://schema.org/ImageObject>
<a href=/media/enblog/julia_write_json/person_data.png itemprop=contentUrl>
<img itemprop=thumbnail src=/media/enblog/julia_write_json/person_data.png alt="Results of person_data.json (rendered on Observablehq)">
</a>
<figcaption>
<p>
Results of person_data.json (rendered on Observablehq)
</p>
</figcaption>
</figure>
<h2 id=references>References<a href=#references class=header-anchor arialabel=Anchor> # </a></h2>
<ul>
<li><a href=https://discourse.julialang.org/t/how-to-write-data-to-file-with-json-jl/2993/2 target=_blank rel="noreferrer noopener">dfdx&rsquo;s response</a>
to the question of <a href=https://discourse.julialang.org/t/how-to-write-data-to-file-with-json-jl/2993 target=_blank rel="noreferrer noopener">How to write data to file with JSON.jl?</a>
</li>
</ul>
<p style=color:#777>Last modified on 2022-06-14</p>
</div>
<a href=#top><i class="fa fa-chevron-up" style=font-size:30px;color:#000></i></a>
</main>
<footer class=footer>
<script src=https://utteranc.es/client.js repo=hongtaoh/hongtaoh.github.io issue-term=pathname theme=github-light crossorigin=anonymous async></script>
<script type=text/javascript src=/js/math-code.js></script>
<script async src="//mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML"></script>
<script type=text/javascript src=/js/center-img.js></script>
<ul class=footer-links>
<li><a href=/en/blog/index.xml type=application/rss+xml title="RSS feed">
Subscribe </a>
</li>
<li>
<a href=http://creativecommons.org/licenses/by-nc-sa/4.0/ target=_blank>
License
<i class="fa fa-cc" aria-hidden=true title="Attribution-NonCommercial-ShareAlike 4.0 International"></i>
</a>
</li>
</ul>
<div class=copyright-text>
©
Hongtao Hao
2020-2022
</div>
</footer>