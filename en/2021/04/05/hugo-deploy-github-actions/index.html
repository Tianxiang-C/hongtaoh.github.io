<a name=top></a><!doctype html>
<html lang=en-us>
<head>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1">
<title>郝鸿涛：Hongtao Hao</title>
<link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css>
<link rel=stylesheet href=/css/style.css>
<link rel=stylesheet href=/css/fonts.css>
<link href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/styles/github.min.css rel=stylesheet>
<script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/highlight.min.js></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/languages/r.min.js></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/languages/bash.min.js></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/languages/python.min.js></script>
<script src=https://cdn.jsdelivr.net/npm/vega@5.17.0></script>
<script src=https://cdn.jsdelivr.net/npm/vega-lite@4.17.0></script>
<script src=https://cdn.jsdelivr.net/npm/vega-embed@6.12.2></script>
<script>hljs.initHighlightingOnLoad()</script>
<link rel=icon href=https://hongtaoh.com/ht10.ico>
</head>
<body>
<div class=wrapper>
<header class=header>
<nav class=nav>
<a href=/ class=nav-logo>
<img src=/media/ht10.png width=50 height=50 alt="Hongtao Hao">
</a>
<ul class=nav-links>
<li><a href=/>Home</a></li>
<li><a href=/en/vitae/>Vitae</a></li>
<li><a href=/en/projects/>Projects</a></li>
<li><a href=/en/blog/>Blog</a></li>
<li><a href=/en/apad/>APAD</a></li>
<li><a href=/cn/blog/>中文</a></li>
</ul>
</nav>
</header>
<main class=content role=main>
<div style=text-align:center>
<h1>How to Deploy A Hugo Website Using GitHub Pages Action</h1>
<p>Hongtao Hao
/ 2021-04-05 </p>
<hr>
</div>
<span class=article-toolbar>
<a href=https://github.com/hongtaoh/hongtaoh.github.io/edit/sources/content/en/blog/2021-04-05-gh-pages-action.md style=font-size:24px;color:#000 target=_blank><i class="fa fa-edit" aria-hidden=true title="Suggest an edit of this page"></i>
</a>
</span>
<div class="body-text list-text">
<p>I didn&rsquo;t find a tutorial in details I deemed necessary, so I decided to craft one by myself. These two sources helped me a lot:</p>
<ul>
<li>
<p><a href=https://github.com/marketplace/actions/github-pages-action target=_blank rel="noreferrer noopener">GitHub Pages Action</a>
</p>
</li>
<li>
<p><a href=https://www.morling.dev/blog/automatically-deploying-hugo-website-via-github-actions/ target=_blank rel="noreferrer noopener">Automatically Deploying a Hugo Website via GitHub Actions</a>
by Gunnar Morling</p>
</li>
</ul>
<h2 id=create-githubworkflowsgh-pagesyml>Create .github/workflows/gh-pages.yml<a href=#create-githubworkflowsgh-pagesyml class=header-anchor arialabel=Anchor> # </a></h2>
<p>First change directory to your Hugo project using <code>cd</code>.</p>
<p>Then</p>
<div class=highlight><pre tabindex=0 style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>mkdir .github
mkdir .github/workflows
touch .github/workflows/gh-pages.yml
</code></pre></div><h3 id=generating-ssh-deploy-key>Generating SSH Deploy Key<a href=#generating-ssh-deploy-key class=header-anchor arialabel=Anchor> # </a></h3>
<p>Open a new Terminal window (Cmd+N on Mac; alt+F2 for git-bash on Windows).</p>
<p>MAC:</p>
<p>Try the following snippet first:</p>
<div class=highlight><pre tabindex=0 style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:green>cd</span> ~/.ssh
</code></pre></div><p>If you see <code>~/.ssh does not exist</code>, then run the following snippet:</p>
<div class=highlight><pre tabindex=0 style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>mkdir -p ~/.ssh
<span style=color:green>cd</span> ~/.ssh
ssh-keygen -t rsa -b <span style=color:#666>4096</span> -C <span style=color:#ba2121>&#34;</span><span style=color:green;font-weight:700>$(</span>git config user.email<span style=color:green;font-weight:700>)</span><span style=color:#ba2121>&#34;</span> -f gh-pages -N <span style=color:#ba2121>&#34;&#34;</span>
open -a Finder ~/.ssh
</code></pre></div><p><div class=info>
The line of <code>mkdir -p ~/.ssh</code> is from <a href=https://superuser.com/a/635270 target=_blank rel="noreferrer noopener">https://superuser.com/a/635270</a>
. If you want to know what <code>mkdir -p</code> means, refer to <a href=https://www.tutorialspoint.com/unix_commands/mkdir.htm target=_blank rel="noreferrer noopener">mkdir - Unix, Linux Command</a>
.
</div></p>
<p>Windows:</p>
<p><div class=warning>
Replace <code>Admin</code> with your own username for your PC.
</div></p>
<p>Try the following snippet first:</p>
<div class=highlight><pre tabindex=0 style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:green>cd</span> C:<span style=color:#b62;font-weight:700>\U</span>sers<span style=color:#b62;font-weight:700>\a</span>dmin<span style=color:#b62;font-weight:700>\.</span>ssh
</code></pre></div><p>If it says the file could not be found, run the following:</p>
<div class=highlight><pre tabindex=0 style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:green>cd</span> /C/Users/Admin
start ~/.ssh
mkdir ~/.ssh/ <span style=color:#666>&amp;&amp;</span> <span style=color:green>cd</span> ~/.ssh
ssh-keygen -t rsa -b <span style=color:#666>4096</span> -C <span style=color:#ba2121>&#34;</span><span style=color:green;font-weight:700>$(</span>git config user.email<span style=color:green;font-weight:700>)</span><span style=color:#ba2121>&#34;</span> -f gh-pages -N <span style=color:#ba2121>&#34;&#34;</span>
start ~/.ssh
</code></pre></div><p>Then you can see two files are generated in the <code>.ssh</code> folder:</p>
<ul>
<li>
<p>gh-pages</p>
</li>
<li>
<p>gh-pages.pub</p>
</li>
</ul>
<p>Now go back to the original Terminal page (the one for your Hugo project) for the following commands.</p>
<h2 id=set-deploy_key>Set deploy_key<a href=#set-deploy_key class=header-anchor arialabel=Anchor> # </a></h2>
<p>MAC:</p>
<div class=highlight><pre tabindex=0 style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>pbcopy &lt; ~/.ssh/gh-pages.pub
</code></pre></div><p>Windows:</p>
<div class=highlight><pre tabindex=0 style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>clip &lt; ~/.ssh/gh-pages.pub
</code></pre></div><p>Go to your <code>username.github.io</code> repository on GitHub -> Settings -> Deploy keys -> Add deploy key.</p>
<p>Press Cmd+V (Windows: Control+V) in the &ldquo;Key&rdquo; section. Check &ldquo;Allow write access&rdquo;. Leave a note to yourself in the &ldquo;Title&rdquo; section. Press &ldquo;Add key&rdquo;.</p>
<p>Go back to your Terminal.</p>
<p>MAC:</p>
<div class=highlight><pre tabindex=0 style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>pbcopy &lt; ~/.ssh/gh-pages
</code></pre></div><p>Windows:</p>
<div class=highlight><pre tabindex=0 style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>clip &lt; ~/.ssh/gh-pages
</code></pre></div><p>Go to your <code>username.github.io</code> repository on GitHub -> Settings -> Secrets -> New repository secret.</p>
<p>Press Cmd+V (Windows: Control+V) in the &ldquo;Value&rdquo; section. In the &ldquo;Name&rdquo; section, input <code>ACTIONS_DEPLOY_KEY</code>. Press &ldquo;Add secret&rdquo;.</p>
<h2 id=generate-personal-access-token>Generate Personal Access Token<a href=#generate-personal-access-token class=header-anchor arialabel=Anchor> # </a></h2>
<p>Click <a href=https://github.com/settings/tokens target=_blank rel="noreferrer noopener">here</a>
to generate a personal access token.</p>
<p>Press &ldquo;Generate new token&rdquo;. Change the default expiration (30 days) if you would like. In &ldquo;Select scopes&rdquo;, check &ldquo;workflow&rdquo;. Then leave a note to yourself in the &ldquo;Note&rdquo; section. Scroll down and press &ldquo;Generate token&rdquo;. Then copy the token you see.</p>
<p>Go back to your <code>username.github.io</code> repository on GitHub -> Settings -> Secrets -> New repository secret.</p>
<p>Press Cmd+V (Windows: Control+V) in the &ldquo;Value&rdquo; section. In the &ldquo;Name&rdquo; section, input <code>PERSONAL_TOKEN</code>. Press &ldquo;Add secret&rdquo;.</p>
<p>If you update your Personal Token later, when you <code>git push</code>, you&rsquo;ll probably see an error:</p>
<div class=highlight><pre tabindex=0 style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>refusing to allow a Personal Access Token to create or update workflow <span style=color:#ba2121>`</span>.github/workflows/gh-pages.yml<span style=color:#ba2121>`</span> without <span style=color:#ba2121>`</span>workflow<span style=color:#ba2121>`</span> scope
</code></pre></div><p>In this case, you need to <a href=https://stackoverflow.com/a/67765064 target=_blank rel="noreferrer noopener">update passwords in Keychain Access</a>
(if you are using a Mac).</p>
<h2 id=add-your-workflow-file>Add your workflow file<a href=#add-your-workflow-file class=header-anchor arialabel=Anchor> # </a></h2>
<p>MAC:</p>
<div class=highlight><pre tabindex=0 style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>open .github/workflows/gh-pages.yml -a TextEdit 
</code></pre></div><p>You can replace <code>TextEdit</code> with <code>"Sublime Text"</code> if you have Sublime Text installed.</p>
<p>Windows:</p>
<div class=highlight><pre tabindex=0 style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>notepad .github<span style=color:#b62;font-weight:700>\w</span>orkflows<span style=color:#b62;font-weight:700>\g</span>h-pages.yml
</code></pre></div><div class=highlight><pre tabindex=0 style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>github pages<span style=color:#bbb>
</span><span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:green;font-weight:700>on</span>:<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>push</span>:<span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>branches</span>:<span style=color:#bbb>
</span><span style=color:#bbb>      </span>- master <span style=color:#bbb> </span><span style=color:#408080;font-style:italic># Set a branch name to trigger deployment</span><span style=color:#bbb>
</span><span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:green;font-weight:700>jobs</span>:<span style=color:#bbb>
</span><span style=color:#bbb>  </span><span style=color:green;font-weight:700>deploy</span>:<span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>runs-on</span>:<span style=color:#bbb> </span>ubuntu-18.04<span style=color:#bbb>
</span><span style=color:#bbb>    </span><span style=color:green;font-weight:700>steps</span>:<span style=color:#bbb>
</span><span style=color:#bbb>      </span>- <span style=color:green;font-weight:700>uses</span>:<span style=color:#bbb> </span>actions/checkout@v2<span style=color:#bbb>
</span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>with</span>:<span style=color:#bbb>
</span><span style=color:#bbb>          </span><span style=color:green;font-weight:700>submodules</span>:<span style=color:#bbb> </span><span style=color:green;font-weight:700>true</span><span style=color:#bbb>  </span><span style=color:#408080;font-style:italic># Fetch Hugo themes (true OR recursive)</span><span style=color:#bbb>
</span><span style=color:#bbb>          </span><span style=color:green;font-weight:700>fetch-depth</span>:<span style=color:#bbb> </span><span style=color:#666>0</span><span style=color:#bbb>    </span><span style=color:#408080;font-style:italic># Fetch all history for .GitInfo and .Lastmod</span><span style=color:#bbb>
</span><span style=color:#bbb>
</span><span style=color:#bbb>      </span>- <span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>Setup Hugo<span style=color:#bbb>
</span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>uses</span>:<span style=color:#bbb> </span>peaceiris/actions-hugo@v2<span style=color:#bbb>
</span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>with</span>:<span style=color:#bbb>
</span><span style=color:#bbb>          </span><span style=color:green;font-weight:700>hugo-version</span>:<span style=color:#bbb> </span><span style=color:#ba2121>&#39;0.79.1&#39;</span><span style=color:#bbb>
</span><span style=color:#bbb>
</span><span style=color:#bbb>      </span>- <span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>Build<span style=color:#bbb>
</span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>run</span>:<span style=color:#bbb> </span>hugo --minify<span style=color:#bbb>
</span><span style=color:#bbb>
</span><span style=color:#bbb>      </span>- <span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>Deploy<span style=color:#bbb>
</span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>uses</span>:<span style=color:#bbb> </span>peaceiris/actions-gh-pages@v3<span style=color:#bbb>
</span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>with</span>:<span style=color:#bbb>
</span><span style=color:#bbb>          </span><span style=color:green;font-weight:700>github_token</span>:<span style=color:#bbb> </span>${{ secrets.PERSONAL_TOKEN }}<span style=color:#bbb>
</span><span style=color:#bbb>          </span><span style=color:green;font-weight:700>publish_branch</span>:<span style=color:#bbb> </span>gh-pages<span style=color:#bbb>
</span><span style=color:#bbb>          </span><span style=color:green;font-weight:700>publish_dir</span>:<span style=color:#bbb> </span>./public<span style=color:#bbb>
</span></code></pre></div><h2 id=push-to-remote>Push to Remote<a href=#push-to-remote class=header-anchor arialabel=Anchor> # </a></h2>
<p>If you haven&rsquo;t pushed anything to your <code>username.github.io</code> repository yet:</p>
<div class=highlight><pre tabindex=0 style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:green>echo</span> <span style=color:#ba2121>&#34;# my hugo website&#34;</span> &gt;&gt; README.md
git init
rm -rf public
hugo
git add README.md
git add .
git commit -m <span style=color:#ba2121>&#34;first commit&#34;</span>
<span style=color:#408080;font-style:italic># For below, please replace USERNAME with your GitHub username</span>
git remote add origin https://github.com/USERNAME/USERNAME.github.io.git
git push -u origin master
</code></pre></div><p>If your <code>username.github.io</code> repository is already established, check whether the current branch&rsquo;s name is &ldquo;master&rdquo;. If not, replace <code>master</code> with your branch&rsquo;s name in <code>.github/workflows/gh-pages.yml</code>. Then</p>
<div class=highlight><pre tabindex=0 style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>git add .
git commit -m <span style=color:#ba2121>&#34;deploying with github pages action&#34;</span>
git push
</code></pre></div><p>Go to your <code>username.github.io</code> repository to see whether the deployment is successful. If yes, go to &ldquo;Settings'', scroll down to &ldquo;Pages&rdquo;. Choose &ldquo;gh-pages'' as the Source branch, then select &ldquo;root&rdquo; as the folder. Click &ldquo;Save&rdquo;. Wait a minute or so and your website will be live at <code>https://USERNAME.github.io/</code>.</p>
<p>If the deployment fails, click the X mark to solve the issues by yourself. I cannot help there.</p>
<p>If you have a personal domain, read <a href=https://www.namecheap.com/support/knowledgebase/article.aspx/9645/2208/how-do-i-link-my-domain-to-github-pages/ target=_blank rel="noreferrer noopener">this post</a>
. It helps even if you are not with namecheap. Also, change the last part of <code>gh-pages.yml</code> to:</p>
<div class=highlight><pre tabindex=0 style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml>- <span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>Deploy<span style=color:#bbb>
</span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>uses</span>:<span style=color:#bbb> </span>peaceiris/actions-gh-pages@v3<span style=color:#bbb>
</span><span style=color:#bbb>        </span><span style=color:green;font-weight:700>with</span>:<span style=color:#bbb>
</span><span style=color:#bbb>          </span><span style=color:green;font-weight:700>github_token</span>:<span style=color:#bbb> </span>${{ secrets.PERSONAL_TOKEN }}<span style=color:#bbb>
</span><span style=color:#bbb>          </span><span style=color:green;font-weight:700>publish_branch</span>:<span style=color:#bbb> </span>gh-pages<span style=color:#bbb>
</span><span style=color:#bbb>          </span><span style=color:green;font-weight:700>publish_dir</span>:<span style=color:#bbb> </span>./public<span style=color:#bbb>
</span><span style=color:#bbb>          </span><span style=color:green;font-weight:700>cname</span>:<span style=color:#bbb> </span>example.com<span style=color:#bbb>
</span></code></pre></div><p>Replace <code>example.com</code> with your own domain. For example, mine: <code>hongtaoh.com</code></p>
<p style=color:#777>Last modified on 2021-12-27</p>
</div>
<a href=#top><i class="fa fa-chevron-up" style=font-size:30px;color:#000></i></a>
</main>
<footer class=footer>
<script src=https://utteranc.es/client.js repo=hongtaoh/hongtaoh.github.io issue-term=pathname theme=github-light crossorigin=anonymous async></script>
<script type=text/javascript src=/js/math-code.js></script>
<script async src="//mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML"></script>
<script type=text/javascript src=/js/center-img.js></script>
<ul class=footer-links>
<li><a href=/en/blog/index.xml type=application/rss+xml title="RSS feed">
Subscribe </a>
</li>
<li>
<a href=http://creativecommons.org/licenses/by-nc-sa/4.0/ target=_blank>
License
<i class="fa fa-cc" aria-hidden=true title="Attribution-NonCommercial-ShareAlike 4.0 International"></i>
</a>
</li>
</ul>
<div class=copyright-text>
©
Hongtao Hao
2020-2021
</div>
</footer>